{% extends 'base.html' %}
{% block title %}テスト結果{% endblock %}

{% block content %}
<style>
    .result-summary { text-align: center; margin-bottom: 2em; }
    .result-summary h2 { font-size: 2em; }
    .result-summary .score { font-size: 3em; font-weight: bold; color: #27ae60; }
    .question-review { margin-bottom: 1.5em; padding: 1em; border: 1px solid #ddd; border-radius: 8px; }
    .review-options { list-style-type: none; padding-left: 1.5em; }
    .review-options li { margin: 0.5em 0; }
    .correct-answer { color: green; font-weight: bold; }
    .wrong-answer { color: red; text-decoration: line-through; }
</style>

<div class="result-container">
    <div class="result-summary">
        <h2>{{ test.test_date }} のテスト結果</h2>
        <p class="score">{{ test.score }} / {{ test.questions|length }}</p>
        {% if message %}<p><strong>{{ message }}</strong></p>{% endif %}
    </div>

    <hr>

    <h3>問題と解答</h3>
    {% for q in questions %}
    <div class="question-review">
        <p><strong>問{{ loop.index }}: {{ q.question_text }}</strong></p>
        <ul class="review-options">
            {% set user_ans = user_answers[q.id] %}
            <li class="{{ 'correct-answer' if 'A' == q.correct_answer else '' }} {{ 'wrong-answer' if 'A' == user_ans and user_ans != q.correct_answer else '' }}">A: {{ q.option_a }}</li>
            <li class="{{ 'correct-answer' if 'B' == q.correct_answer else '' }} {{ 'wrong-answer' if 'B' == user_ans and user_ans != q.correct_answer else '' }}">B: {{ q.option_b }}</li>
            <li class="{{ 'correct-answer' if 'C' == q.correct_answer else '' }} {{ 'wrong-answer' if 'C' == user_ans and user_ans != q.correct_answer else '' }}">C: {{ q.option_c }}</li>
            <li class="{{ 'correct-answer' if 'D' == q.correct_answer else '' }} {{ 'wrong-answer' if 'D' == user_ans and user_ans != q.correct_answer else '' }}">D: {{ q.option_d }}</li>
        </ul>
        <p>あなたの解答: {{ user_ans }} | 正解: {{ q.correct_answer }}</p>
    </div>
    {% endfor %}
    <a href="{{ url_for('ai_test.test_history') }}">テスト履歴に戻る</a>
</div>
{% endblock %}