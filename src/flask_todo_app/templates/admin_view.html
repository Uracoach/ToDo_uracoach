{% extends 'base.html' %}
{% block title %}ç®¡ç†ãƒ“ãƒ¥ãƒ¼: {{ student.name }}{% endblock %}
{% block content %}
    <h2>{{ student.name }}ã®ToDoé–²è¦§ï¼ˆ{{ date }})</h2>
    <a href="{{ url_for('main.student_chart', student_name=student.name) }}" target="_blank">ğŸ“Š {{ student.name }}ã®å­¦ç¿’ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹</a>
    
    <hr style="margin: 2em 0;">
    
    <h3>ä»Šé€±ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h3>
    <div style="background: #fff; padding: 1.5em; border-radius: 8px; margin-bottom: 2em;">
        <h4>æ–°ã—ã„ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¿½åŠ </h4>
        <form action="{{ url_for('admin.add_mission', student_name=student.name) }}" method="POST">
            <textarea name="description" rows="2" style="width: 98%;" required placeholder="ä¾‹ï¼šä»Šé€±ã¯æ•°å­¦ã®èª²é¡ŒP.50ï½P.55ã‚’çµ‚ã‚ã‚‰ã›ã‚‹ï¼"></textarea><br>
            <input type="submit" value="ã“ã®ç”Ÿå¾’ã«ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¿½åŠ " style="width: auto; margin-top: 0.5em;">
        </form>
        <hr>
        <h4>è¨­å®šæ¸ˆã¿ãƒŸãƒƒã‚·ãƒ§ãƒ³</h4>
        {% if missions %}
        <table>
            <thead><tr><th>å†…å®¹</th><th>çŠ¶æ…‹</th><th>æ“ä½œ</th></tr></thead>
            <tbody>
            {% for mission in missions %}
            <tr>
                <td>{{ mission.description }}</td>
                <td>
                    {% if mission.completed %}
                        <span style="color: green; font-weight: bold;">âœ” é”æˆæ¸ˆã¿</span>
                    {% else %}
                        <span style="color: #888;">æœªé”æˆ</span>
                    {% endif %}
                </td>
                <td>
                    <form action="{{ url_for('admin.mark_mission_complete', mission_id=mission.id) }}" method="POST">
                        <input type="submit" value="{{ 'æœªé”æˆã«æˆ»ã™' if mission.completed else 'å®Œäº†ã«ã™ã‚‹' }}" style="width: auto; padding: 5px 10px; font-size: 0.9em; background-color: #555;">
                    </form>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>ä»Šé€±ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>

    <h3>ToDoãƒªã‚¹ãƒˆ</h3>
    <form method="GET">
        <input type="date" name="date" value="{{ date }}">
        <input type="submit" value="æ—¥ä»˜ã§è¡¨ç¤º" style="width: auto; padding: 5px 10px;">
    </form>
    <table>
        <thead>
            <tr><th>å®Œäº†</th><th>æ•™ç§‘</th><th>æ•™æ</th><th>ãƒšãƒ¼ã‚¸</th><th>ç›®æ¨™</th><th>å®Ÿç¸¾</th><th>ä¼‘æ†©</th></tr>
        </thead>
        <tbody>
        {% for todo in todos %}
        <tr>
            <td>{{ 'âœ”' if todo.completed else ' ' }}</td>
            <td>{{ todo.subject }}</td>
            <td>{{ todo.material }}</td>
            <td>{{ todo.start_page }} - {{ todo.end_page }}</td>
            <td>{{ todo.target_hour }}h {{ todo.target_min }}m</td>
            <td>{{ todo.actual_hour }}h {{ todo.actual_min }}m</td>
            <td>{{ (todo.break_seconds or 0) // 60 }}åˆ† {{ (todo.break_seconds or 0) % 60 }}ç§’</td>
        </tr>
        {% else %}
        <tr><td colspan="7">ã“ã®æ—¥ã®ToDoã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}